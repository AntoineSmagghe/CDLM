{% extends 'base.html.twig' %}
{% block title %}{{article.text[:200]|striptags }}{% endblock %}
{% block header %}
{% endblock %}
{% block style %}
<link rel="stylesheet" href="/css/label.css">
{% endblock %}
{% block body %}
<section id="release">
    <aside id="member_picture">
        <figure>
            {% if article.imgs.snapshot != [] %}
                {% if cover != null %}
                <img class="article_image_cover" src="{{ asset('/upload/pictures/' ~ cover.name) | imagine_filter('450x340') }}" alt="cover : {{article.title}}" >
                {% else %}
                <img class="article_image_cover" src="{{ asset('/upload/pictures/' ~ article.imgs|first.name ) | imagine_filter('450x340') }}" alt="cover : {{article.title}}" >
                {% endif %}
            {% else %}
            <img class="article_image_cover" src="{{ asset('/img/Arthur/DSCF6226.jpg') | imagine_filter('450x340') }}" alt="cover : {{article.title}}">
            {% endif %}
            <figcaption id="artist_release_figcaption">
            {% if app.user != null %}
                    <p>Créé le {{ article.createdAt|date("d/m/Y \à H:i:s", "Europe/Paris") }} par {{ article.user.surname }}</p>
                {% if article.modifiedBy != '' %}
                    <p>Modifié le {{ article.updatedAt|date("d/m/Y \à H:i:s", "Europe/Paris") }} par {{ article.modifiedBy.surname }}</p>
                {% endif %}
            {% endif %}
            <div class="contact_socials">
                <a href="mailto:cdlm-free@gmail.com" class="socials_logo"><img src="/img/envelope-open-text-solid.svg" alt="logo email"></a>
            </div>
            {% if is_granted('ROLE_ADMIN') %}
            <a href="{{ path("editPost", { "id" : article.id }) }}" class="a_btn btn_modify">Modifier</a>
            {% endif %}
            </figcaption>
        </figure>
    </aside>
    <article id="member_text_soundcloud">
        <h1>{{article.title}}</h1>
        <div class="text">{{article.text|raw}}</div>
        {% if article.apiData != null %}
            <h2>Sets</h2>
            <div class="widget_SC"></div>
        {% endif %}
        {% if article.imgs.snapshot != null %}
            <h2>Images</h2>
            <div class="hes-gallery member_images">
            {% for image in article.imgs %}
                    <img src="{{ asset('/upload/pictures/' ~ image.name) | imagine_filter('200x150') }}" data-fullsize="{{ asset('/upload/pictures/' ~ image.name) }}" alt="Photo {{image.id}} de l'article : {{ article.title }}">
            {% endfor %}
            </div>
        {% endif %}
    </article>
</section>
{% endblock %}
{% block javascripts %}
<script src="https://unpkg.com/hes-gallery/dist/hes-gallery.min.js"></script>
<script src="https://connect.soundcloud.com/sdk/sdk-3.3.2.js"></script>
<script type="text/javascript">
    SC.initialize({
            client_id: 'h3reaiIhlDG8GqF3EAhi6mQWjWREp0LQ'
        });

        {% for sound in article.apiData %}
            SC.resolve(" {{sound}} ")
                .then((track)=>{
                    document.getElementsByClassName("widget_SC")[0].insertAdjacentHTML("beforeend", '<iframe width="100%" height="20" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/' + track.id + '&color=%230e0d26&inverse=true&auto_play=false&show_user=true"></iframe>');
            });
        {% endfor %}
</script>
{% endblock %}